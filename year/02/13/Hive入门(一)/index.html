<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">














    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            Hive入门(一) | 
        
        Geek Liao
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/headshow.gif">
    <link rel="icon" href="/img/headshow.gif">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="">
    <meta name="keywords" content="">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Geek Liao">
    <meta name="msapplication-starturl" content="http://changzeng.github.io/year/02/13/Hive入门(一)/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Geek Liao">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/headshow.gif">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://changzeng.github.io/year/02/13/Hive入门(一)/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Hive入门(一) | Geek Liao">
    <meta property="og:image" content="/img/headshow.gif">
    <meta property="og:description" content="">
    

    
        <meta property="article:published_time" content="Tue Feb 13 2018 17:48:57 GMT+0800">
        <meta property="article:modified_time" content="Wed Feb 14 2018 20:57:55 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://changzeng.github.io/year/02/13/Hive入门(一)/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://changzeng.github.io/year/02/13/Hive入门(一)/index.html",
    "headline": "Hive入门(一)",
    "datePublished": "Tue Feb 13 2018 17:48:57 GMT+0800",
    "dateModified": "Wed Feb 14 2018 20:57:55 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "changzeng",
        "image": {
            "@type": "ImageObject",
            "url": "/img/headshow.gif"
        },
        "description": "Hi, nice to meet you"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Geek Liao",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/headshow.gif"
        }
    },
    "keywords": "",
    "description": "",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hive的特点"><span class="post-toc-number">1.</span> <span class="post-toc-text">Hive的特点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hive-DDL"><span class="post-toc-number">2.</span> <span class="post-toc-text">Hive DDL</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hive-DML"><span class="post-toc-number">3.</span> <span class="post-toc-text">Hive DML</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HQL数据查询语法"><span class="post-toc-number">4.</span> <span class="post-toc-text">HQL数据查询语法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Join"><span class="post-toc-number">5.</span> <span class="post-toc-text">Join</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#排序"><span class="post-toc-number">6.</span> <span class="post-toc-text">排序</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hive自定义函数"><span class="post-toc-number">7.</span> <span class="post-toc-text">Hive自定义函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hive执行原理与优化"><span class="post-toc-number">8.</span> <span class="post-toc-text">Hive执行原理与优化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hadoop性能瓶颈"><span class="post-toc-number">9.</span> <span class="post-toc-text">Hadoop性能瓶颈</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HiveQL层面优化"><span class="post-toc-number">10.</span> <span class="post-toc-text">HiveQL层面优化</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Hive入门(一)
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/headshow.gif" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>changzeng</strong>
        <span>2月 13, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Hive入门(一)&url=http://changzeng.github.io/year/02/13/Hive入门(一)/index.html&pic=http://changzeng.github.io/img/headshow.gif&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Hive入门(一)&url=http://changzeng.github.io/year/02/13/Hive入门(一)/index.html&via=changzeng" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://changzeng.github.io/year/02/13/Hive入门(一)/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://changzeng.github.io/year/02/13/Hive入门(一)/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h3 id="Hive的特点"><a href="#Hive的特点" class="headerlink" title="Hive的特点"></a>Hive的特点</h3><ol>
<li>Hive 最大的特点是 Hive 通过类 SQL 来分析大数据，而避免了写 MapReduce Java 程序来分析数据，这样使得分析数据更容易。</li>
<li>数据是存储在 HDFS 上的，Hive 本身并不提供数据的存储功能</li>
<li>Hive 是将数据映射成数据库和一张张的表，库和表的元数据信息一般存在关系型数据库上 （比如 MySQL）。</li>
<li>数据存储方面：他能够存储很大的数据集，并且对数据完整性、格式要求并不严格。</li>
<li>数据处理方面：不适用于实时计算和响应，使用于离线分析。</li>
</ol>
<h3 id="Hive-DDL"><a href="#Hive-DDL" class="headerlink" title="Hive DDL"></a>Hive DDL</h3><ol>
<li><p>创建数据库</p>
<p>create database if not exists dealer_db;</p>
</li>
<li><p>查看数据库定义</p>
<p>describe database dealer_db;</p>
</li>
<li><p>查看数据库列表</p>
<p>show databases;</p>
</li>
<li><p>删除数据库</p>
<p>drop database if exists testdb cascade;</p>
<p>删除数据库时，如果库中存在数据表，是不能删除的，要先删除所有表，再删除数据库。添加上 cascade 后，就可以先自动删除所有表后，再删除数据库。删除数据库后，HDFS 上数据库对应的目录就被删除掉了。</p>
</li>
<li><p>切换当前数据库</p>
<p>use dealer_db;</p>
</li>
<li><p>创建普通表</p>
<p>create table if not exists dealerinfo</p>
<p>(</p>
<p>​    dealerid int,</p>
<p>​    dealername string,</p>
<p>​    cityid int,</p>
<p>​    createtime date</p>
<p>)</p>
<p>row format delimited fields terminated by ‘\t’</p>
<p>stored as textfile;</p>
<ul>
<li>create table 方式：以上例子中的方式。</li>
<li>create table as select 方式：根据查询的结果自动创建表，并将查询结果数据插入新建的表中。</li>
<li>create table like tablename1 方式：是克隆表，只复制 tablename1 表的结构</li>
</ul>
</li>
<li><p>创建外部表</p>
<p>外部表是没有被 hive 完全控制的表，当表删除后，数据不会被删除，</p>
<p>create external table iislog_ext (</p>
<p>​    ip string,</p>
<p>​    logtime string</p>
<p>)</p>
</li>
<li><p>创建分区表</p>
<p>Hive 查询一般是扫描整个目录，但是有时候我们关心的数据只是集中在某一部分数据上，比如我 们一个 Hive 查询，往往是只是查询某一天的数据，这样的情况下，可以使用分区表来优化，一 天是一个分区，查询时候，Hive 只扫描指定天分区的数据。</p>
<p>普通表和分区表的区别在于：一个 Hive 表在 HDFS 上是有一个对应的目录来存储数据，普通表的 数据直接存储在这个目录下，而分区表数据存储时，是再划分子目录来存储的。一个分区一个子 目录。主要作用是来优化查询性能。</p>
</li>
<li><p>创建桶表</p>
<ul>
<li><p>桶表也是一种用于优化查询而设计的表类型。创建通表时，指定桶的个数、分桶的依据字 段，hive 就可以自动将数据分桶存储。查询时只需要遍历一个桶里的数据，或者遍历部分 桶，这样就提高了查询效率。</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create table dealer_leads</span><br><span class="line">(</span><br><span class="line">	leads_id string,</span><br><span class="line">	dealer_id string,</span><br><span class="line">	user_id string,</span><br><span class="line">	user_phone string,	</span><br><span class="line">	user_name string,</span><br><span class="line">	create_time string</span><br><span class="line">)</span><br><span class="line">clustered by (dealer_id) sorted by(leads_id) into 10 buckets</span><br><span class="line">row format delimited fields terminated by &apos;\t&apos;</span><br><span class="line">stored as textfile;</span><br></pre></td></tr></table></figure>
</li>
<li><p>说明</p>
<ol>
<li>clustered by 是指根据 dealer_id 的值进行哈希后模除分桶个数，根据得到的结果，确 定这行数据分入哪个桶中，这样的分法，可以确保相同 dealer_id 的数据放入同一个桶 中。而经销商的线索数据，大部分是根据 dealer_id 进行查询的。这样大部分情况下是 只需要查询一个桶中的数据就可以了。</li>
<li>sorted by 是指定桶中的数据以哪个字段进行排序，排序的好处是，在 join 操作时能获 得很高的效率。</li>
<li>into 10 buckets 是指定一共分多少个桶。</li>
<li>在 HDFS 上存储时，一个桶存入一个文件中，这样根据 dealer_id 进行查询时，可以快速 确定数据存在于哪个桶中，而只遍历一个桶可以提供查询效率。</li>
</ol>
</li>
</ul>
</li>
</ol>
<h3 id="Hive-DML"><a href="#Hive-DML" class="headerlink" title="Hive DML"></a>Hive DML</h3><ol>
<li><p>向Hive中加载数据</p>
<ul>
<li><p>加载到普通表</p>
<p>load data local inpath ‘/home/hadoop/dealerinfodata.txt’ overwrite into table dealer_info;</p>
<ol>
<li>local 关键字表示源数据文件在本地，源文件可以在 HDFS 上，如果在 HDFS 上，则去掉 local，inpath 后面的路径是类似”hdfs://namenode:9000/user/datapath”这样的 HDFS 上文件的路径。</li>
<li>overwrite 关键字表示如果 hive 表中存在数据，就会覆盖掉原有的数据。如果省略overwrite，则默认是追加数据。</li>
</ol>
</li>
<li><p>加载到分区表</p>
<p>load data local inpath ‘/home/hadoop/actionlog.txt’ overwrite into table dealer_action_log PARTITION (dt=’2016-08-19’);</p>
<p>partition 是指定这批数据放入分区 2016-08-19 中。</p>
</li>
<li><p>加载到分桶表</p>
<ol>
<li><p>创建临时表</p>
</li>
<li><p>set hive.enforce.bucketing = true;</p>
</li>
<li><p>insert overwrite table dealer_leads select * from dealer_leads_tmp;</p>
<p>set hive.enforce.bucketing = true; 这个配置非常关键，为 true 就是设置为启用分桶。</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p>导出数据</p>
<p>insert overwrite local directory ‘/home/hadoop/dealer_info.bak2016-08-22 select * from dealer_info;</p>
<p>去掉 local 关键字，也可以到处到 HDFS 上。</p>
</li>
<li><p>插入数据</p>
<ul>
<li>insert select 语句</li>
<li>一次遍历多次插入</li>
</ul>
</li>
<li><p>复制表</p>
</li>
<li><p>克隆表</p>
<p>create table dealer_leads_like like dealer_leads;</p>
</li>
<li><p>备份表</p>
<p>export table dealer_action_log partition (dt=’2016-08-19’) to ‘/user/hive/action_log.export’</p>
</li>
<li><p>还原表</p>
<p>import table dealer_action_log_like from ‘/user/hive/action_log.export’;</p>
</li>
</ol>
<h3 id="HQL数据查询语法"><a href="#HQL数据查询语法" class="headerlink" title="HQL数据查询语法"></a>HQL数据查询语法</h3><ol>
<li>Select<ul>
<li>指定列表</li>
<li>函数列</li>
<li>算数运算列</li>
<li>限制返回条数</li>
<li>Case When Then 语句</li>
</ul>
</li>
<li>Where 筛选</li>
<li>Group By 分组</li>
<li>*子查询</li>
</ol>
<h3 id="Join"><a href="#Join" class="headerlink" title="Join"></a>Join</h3><ol>
<li>Hive Join的限制<ul>
<li>只支持等值连接</li>
<li>连接谓词中不支持 or</li>
</ul>
</li>
<li>Inner join</li>
<li>Left join</li>
<li>Right join</li>
<li>Full join</li>
<li>Left Semi-Join ( exists 语句)</li>
</ol>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><ol>
<li><p>Order By</p>
<p>Order By 这样的操作，肯定要在 Map 后汇集到一个 Reduce 上执行，如果结果数据量大，那就会造成 Reduce 执行相当漫长。</p>
</li>
<li><p>Sort By</p>
<p>Sort By 是在每个 reduce 中进行排序，是一个局部排序。</p>
</li>
<li><p>Distribute By 和 Sort By</p>
<p>Distribute By 指定 map 输出结果怎么样划分后分配到各个 Reduce 上去，比如 Distribute By dealer_id，就可以保证 dealer_id 字段相同的结果被分配到同一个 reduce 上去执行。然后再指 定 Sort By dealer_id，则在 Reduce 上进行按照 dealer_id 进行排序。</p>
</li>
<li><p>Cluster By</p>
<p>如果 Distribute By 和 Sort By 的字段是同一个，可以简写为 Cluster By</p>
</li>
<li><p>常见全局排序需求</p>
<ul>
<li>最终结果是有序的</li>
<li>取前 N 条</li>
</ul>
</li>
</ol>
<h3 id="Hive自定义函数"><a href="#Hive自定义函数" class="headerlink" title="Hive自定义函数"></a>Hive自定义函数</h3><h3 id="Hive执行原理与优化"><a href="#Hive执行原理与优化" class="headerlink" title="Hive执行原理与优化"></a>Hive执行原理与优化</h3><ol>
<li><p>Hive核心</p>
<ul>
<li>解释器</li>
<li>编译器</li>
<li>优化器</li>
<li>执行器</li>
</ul>
</li>
<li><p>Hive的底层存储</p>
<p>Hive 的数据是存储在 HDFS 上的。Hive 中的库和表可以看做是对 HDFS 上数据做的一个映射。所 以 Hive 必须是运行在一个 Hadoop 集群上的。</p>
</li>
<li><p>Hive 程序的执行过程</p>
<p>Hive 中的执行器，是将最终要执行的 MapReduce 程序放到 YARN 上以一系列 Job 的方式去执行。</p>
</li>
<li><p>Hive 的元数据存储</p>
<p>Hive 的元数据是一般是存储在 MySQL 这种关系型数据库上的，Hive 和 MySQL 之间通过 MetaStore服务交互。</p>
</li>
</ol>
<h3 id="Hadoop性能瓶颈"><a href="#Hadoop性能瓶颈" class="headerlink" title="Hadoop性能瓶颈"></a>Hadoop性能瓶颈</h3><p>Hadoop 的核心能力是 parition 和 sort，因而这也是优化的根本。</p>
<h3 id="HiveQL层面优化"><a href="#HiveQL层面优化" class="headerlink" title="HiveQL层面优化"></a>HiveQL层面优化</h3><ol>
<li><p>利用分区表优化</p>
</li>
<li><p>利用桶表优化</p>
</li>
<li><p>join优化</p>
<ul>
<li><p>优先过滤后再 join,最大限度地减少参与 Join 的数据量。</p>
</li>
<li><p>小表 join 大表原则</p>
<p>应该遵守小表 join 大表原则，原因是 Join 操作的 reduce 阶段，位于 join 左边的表内容会 被加载进内存，将条目少的表放在左边，可以有效减少发生内存溢出的几率。join 中执行 顺序是从左到右生成 Job，应该保证连续查询中的表的大小从左到右是依次增加的。</p>
</li>
<li><p>join on 条件相同的放入一个 job</p>
</li>
</ul>
</li>
<li><p>启用mapjoin</p>
</li>
<li><p>桶表mapjoin</p>
</li>
<li><p>Group By 数据倾斜优化</p>
<ul>
<li>Group By 很容易导致数据倾斜问题，因为实际业务中，通常是数据集中在某些点上，这也符合常 见的 2/8 原则，这样会造成对数据分组后，某一些分组上数据量非常大，而其他的分组上数据量 很小，而在 mapreduce 程序中，同一个分组的数据会分配到同一个 reduce 操作上去，导致某一 些 reduce 压力很大，其他的 reduce 压力很小，这就是数据倾斜，整个 job 执行时间取决于那个 执行最慢的那个 reduce。</li>
<li>解决这个问题的方法是配置一个参数：set hive.groupby.skewindata=true。</li>
<li>当选项设定为 true，生成的查询计划会有两个 MR Job。第一个 MR Job 中， Map 的输出结果会 随机分布到 Reduce 中，每个 Reduce 做部分聚合操作，并输出结果，这样处理的结果是相同的 Group By Key 有可能被分发到不同的 Reduce 中，从而达到负载均衡的目的，在第一个 Job 中 通过聚合操作减少了数据量；第二个 MR Job 再根据预处理的数据结果按照 Group By Key 分布 到 Reduce 中（这个过程可以保证相同的 GroupBy Key 被分布到同一个 Reduce 中），最后完 成最终的聚合操作。</li>
</ul>
</li>
<li><p>Order By 优化</p>
<ul>
<li>因为 order by 只能是在一个 reduce 进程中进行的，所以如果对一个大数据集进行 order by,会 导致一个 reduce 进程中处理的数据相当大，造成查询执行超级缓慢。在要有进行 order by 全局 排序的需求时，用以下几个措施优化：</li>
<li>在最终结果上进行 order by，不要在中间的大数据集上进行排序。如果最终结果较少，可以 在一个 reduce 上进行排序时，那么就在最后的结果集上进行 order by。</li>
<li>如果需求是取排序后前 N 条数据，那么可以使用 distribute by 和 sort by 在各个 reduce 上进行排序后取前 N 条，然后再对各个 reduce 的结果集合并后在一个 reduce 中全局排序，再取前 N 条，因为参与全局排序的 Order By 的数据量最多有 reduce 个数*N，所以速度很快。</li>
</ul>
</li>
<li><p>Group By Map 端聚合</p>
<p>并不是所有的聚合操作都需要在 Reduce 端完成，很多聚合操作都可以先在 Map 端进行部分聚 合，最后在 Reduce 端得出最终结果。</p>
<p>hive.map.aggr = true 是否在 Map 端进行聚合，默认为 True。</p>
<p>hive.groupby.mapaggr.checkinterval = 100000 在 Map 端进行聚合操作的条目数目</p>
</li>
<li><p>一次读取多次插入</p>
<p>有些场景是从一个表读取数据后，要多次利用，这时候就可以使用 multi insert 语法：</p>
<p>每次 hive 查询，都会将数据集整个遍历一遍。当查询结果会插入多个表中时，可以采用以上语 法，将一次遍历写入多个表，以达到提高效率的目的</p>
</li>
<li><p>Join 字段显示类型转换</p>
<p>当参与 join 的字段类型不一致时，Hive 会自动进行类型转换，但是自动转换有时候效率并不 高，可以根据实际情况通过显示类型转换来避免 HIVE 的自动转换。</p>
</li>
<li><p>使用 orc、parquet 等列式存储格式</p>
<p>创建表时，尽量使用 orc、parquet 这些列式存储格式，因为列式存储的表，每一列的数据在物 理上是存储在一起的，Hive 查询时会只遍历需要列数据，大大减少处理的数据量。</p>
</li>
</ol>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/year/02/14/Hive之join原理/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/year/02/12/PCA主成分分析/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/headshow.gif" alt="changzeng's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        lcznotme@sina.cn
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/02/">二月 2018<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">55</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Geek Liao
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
    
</html>
